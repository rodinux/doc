"use strict";(self.webpackChunkyunohost_docs=self.webpackChunkyunohost_docs||[]).push([[6990],{7440:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>l,contentTitle:()=>r,default:()=>d,frontMatter:()=>a,metadata:()=>s,toc:()=>c});const s=JSON.parse('{"id":"contribute/packaging_apps/index","title":"Packaging applications","description":"This documentation is here to provide all the basic concepts and vocabulary needed to understand app packaging.","source":"@site/docs/06.contribute/10.packaging_apps/index.mdx","sourceDirName":"06.contribute/10.packaging_apps","slug":"/contribute/packaging_apps/","permalink":"/contribute/packaging_apps/","draft":false,"unlisted":false,"editUrl":"https://github.com/YunoHost/doc/tree/docusaurus/docs/06.contribute/10.packaging_apps/index.mdx","tags":[],"version":"current","frontMatter":{"title":"Packaging applications"},"sidebar":"docsSidebar","previous":{"title":"Contribute via Github","permalink":"/contribute/write_documentation/git"},"next":{"title":"Writing the app manifest","permalink":"/contribute/packaging_apps/manifest/"}}');var t=i(4848),o=i(8453);const a={title:"Packaging applications"},r=void 0,l={},c=[{value:"1. Packaging philosophy",id:"1-packaging-philosophy",level:2},{value:"2. Prerequisites",id:"2-prerequisites",level:2},{value:"3. Notes about the history of YunoHost&#39;s app packaging",id:"3-notes-about-the-history-of-yunohosts-app-packaging",level:2},{value:"4. General overview of a YunoHost app structure",id:"4-general-overview-of-a-yunohost-app-structure",level:2},{value:"5. Creating your very first YunoHost package",id:"5-creating-your-very-first-yunohost-package",level:2}];function h(e){const n={a:"a",code:"code",h2:"h2",li:"li",ol:"ol",p:"p",strong:"strong",ul:"ul",...(0,o.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.p,{children:"This documentation is here to provide all the basic concepts and vocabulary needed to understand app packaging."}),"\n",(0,t.jsx)(n.p,{children:"We will detail what a YunoHost application package is, how it works, how to make your own package and how to find help if you need it."}),"\n",(0,t.jsx)(n.h2,{id:"1-packaging-philosophy",children:"1. Packaging philosophy"}),"\n",(0,t.jsx)(n.p,{children:"The ability to easily install applications from a catalog is a key feature of YunoHost. While you dive in the process of YunoHost application packaging, you should remember these key principles:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"The admin should not have a PhD in computer science to be able to install, configure and use your application"}),": try to assume that the admin doesn't know about advanced computer concepts;"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Less is more"}),", ",(0,t.jsx)(n.strong,{children:"Keep it simple!"}),": don't overcrowd the admin with a dozens technical questions;"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Things should work out of the box"}),": for example, the admin should not have to manually finish the installation process by manually filling in database credentials;"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsxs)(n.p,{children:["YunoHost app packaging is ",(0,t.jsx)(n.strong,{children:"not just about installing"})," sources and dependencies: it's also about maintenance (upgrade, backup...) and integrating the app in the YunoHost ecosystem (NGINX, SSO/LDAP, Fail2Ban, application catalog, UI/UX...)"]}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"2-prerequisites",children:"2. Prerequisites"}),"\n",(0,t.jsx)(n.p,{children:"Before diving in, this documentation assumes that:"}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsx)(n.li,{children:"You already are a YunoHost admin yourself and already know what the install workflow looks like;)"}),"\n",(0,t.jsx)(n.li,{children:"You are somewhat familiar with (or are willing to learn) system administration and bash programming;"}),"\n",(0,t.jsx)(n.li,{children:"You are somewhat familiar with (or are willing to learn) Git;"}),"\n",(0,t.jsx)(n.li,{children:"You are comfortable with tinkering and debugging computer stuff in general."}),"\n"]}),"\n",(0,t.jsxs)(n.p,{children:["You are also encouraged to join the ",(0,t.jsx)(n.a,{href:"/chat_rooms",children:"app packaging chatroom"})," to ask any question you may have!"]}),"\n",(0,t.jsxs)(n.p,{children:["At some point, you will also want to have a dev/test environment, either using ",(0,t.jsx)(n.a,{href:"/packaging_apps_virtualbox",children:"VirtualBox"})," or ",(0,t.jsx)(n.a,{href:"https://github.com/yunohost/ynh-dev",children:"LXC/ynh-dev"})," which is meant for the core but can totally be used for developping apps. You can also setup a dev/test VPS on your favourite hosting provider, or even develop on your prod if you like to live dangerously;)."]}),"\n",(0,t.jsx)(n.h2,{id:"3-notes-about-the-history-of-yunohosts-app-packaging",children:"3. Notes about the history of YunoHost's app packaging"}),"\n",(0,t.jsx)(n.p,{children:"Many things in YunoHost, and YunoHost app packaging format, are historical or were designed in an organic fashion. Thus some aspects may legitimately feel old."}),"\n",(0,t.jsxs)(n.p,{children:["The ",(0,t.jsx)(n.strong,{children:'"v0" of app packaging'})," consisted in writing raw bash scripts with no real standardization/constrain."]}),"\n",(0,t.jsxs)(n.p,{children:['Over time, recurrent steps (such as installing dependencies with apt, or setting up the NGINX config) where formalized into standardized bash functions, aka "helpers". This pretty much marked ',(0,t.jsx)(n.strong,{children:'the beginning of the "v1" packaging era'}),"."]}),"\n",(0,t.jsx)(n.p,{children:"Various tools were implemented to test the app and standardize their behavior."}),"\n",(0,t.jsxs)(n.p,{children:["After a while, a set of common practices and conventions emerged and is somewhat reflected and maintain in the ",(0,t.jsx)(n.code,{children:"example_ynh"})," template application. While it is tempting for dev-oriented folks to change variable naming schemes or refactorize the structure of scripts, it turns out that it is even more important to stick to the common set of practices (even though arbitrary and not elegant) to ease the maintenance of all apps by any member of the packaging community accross all repos!"]}),"\n",(0,t.jsxs)(n.p,{children:["Nevertheless, even though helpers existed, the inherent structure of apps was hard and boring to maintain with too many redundant pieces of code or filled with funky historical conventions. ",(0,t.jsx)(n.strong,{children:"A new v2 format"})," ",(0,t.jsx)(n.a,{href:"https://github.com/YunoHost/yunohost/pull/1289",children:"has been designed and added to YunoHost 11.1 in early 2023"})," in the hope to modernize and simplify app packaging and improve the UI/UX of YunoHost."]}),"\n",(0,t.jsxs)(n.p,{children:["However, ",(0,t.jsxs)(n.a,{href:"https://github.com/YunoHost/issues/issues/2136",children:[(0,t.jsx)(n.strong,{children:"a future v3 format"})," has yet to come"]})," to further simplify app packaging (such as taking care of NGINX/systemd/... configurations, removing the need to manually write remove/backup/restore scripts, etc.)"]}),"\n",(0,t.jsx)(n.h2,{id:"4-general-overview-of-a-yunohost-app-structure",children:"4. General overview of a YunoHost app structure"}),"\n",(0,t.jsx)(n.p,{children:"A YunoHost app consists in a Git repository. We encourage you to have a look at those code repository to get familiar witch app repository structures:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:(0,t.jsxs)(n.a,{href:"https://github.com/YunoHost-Apps/helloworld_ynh",children:["the ",(0,t.jsx)(n.code,{children:"helloworld_ynh"})," app"]})}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsxs)(n.a,{href:"https://github.com/YunoHost/example_ynh",children:["the ",(0,t.jsx)(n.code,{children:"example_ynh"})," app"]})," which illustrates all common features and recommended formatting"]}),"\n",(0,t.jsxs)(n.li,{children:['your favourite "real-life" app in the ',(0,t.jsx)(n.a,{href:"https://github.com/orgs/YunoHost-Apps/repositories",children:"YunoHost-Apps organization"})]}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:"Among the file contained in a package, the most important ones are:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["the ",(0,t.jsx)(n.strong,{children:"app manifest"})," ",(0,t.jsx)(n.code,{children:"manifest.toml"})," ",(0,t.jsxs)("small",{children:["(or ",(0,t.jsx)(n.code,{children:".json"})," in the past)"]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"this can be seen as the ID card of the application, containing various metadatas."}),"\n",(0,t.jsx)(n.li,{children:"it also contains the questions asked during the installation of the app."}),"\n",(0,t.jsx)(n.li,{children:'and a bunch of "resources" to initialize, such as sources to download or apt dependencies to install'}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"scripts/"})," contains a bunch of bash scripts corresponding to actions exposed in YunoHost","\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"_common.sh"}),": common variables or custom functions included in other scripts"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"install"}),"/",(0,t.jsx)(n.code,{children:"remove"}),": the install and remove procedure"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"upgrade"}),": the upgrade procedure"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"backup"}),"/",(0,t.jsx)(n.code,{children:"restore"}),": the backup/restore procedures"]}),"\n",(0,t.jsxs)(n.li,{children:["(",(0,t.jsx)(n.code,{children:"change_url"}),"): changing where the app is installed in terms of web access url"]}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"conf/"})," contains a bunch of configuration templates used when installing the app. Here are some example of commonly found files:","\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"nginx.conf"}),": the NGINX (=web server) configuration template for this app"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"systemd.service"}),": the systemd service configuration template for this app"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"config.json/yaml/???"}),": the app's configuration template"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:"Roughly speaking, the install itself generally consists of the following operations (though these may vary depending on the complexity and technologies used by the app) - not necessarily in that exact order:"}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsx)(n.p,{children:"YunoHost fetches the package's Git repository"}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsxs)(n.p,{children:["YunoHost asks to the admin the install questions defined in ",(0,t.jsx)(n.code,{children:"manifest.toml"})]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsx)(n.p,{children:"The admin fills the form and starts the install"}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsx)(n.p,{children:"YunoHost provisions a bunch of technical prerequisites (called 'resources') such as:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["initializes the app'skey/value store ",(0,t.jsx)(n.code,{children:"settings.yml"})," with the admin's answers to the install form"]}),"\n",(0,t.jsx)(n.li,{children:"creates a UNIX system user for this app"}),"\n",(0,t.jsx)(n.li,{children:"install apt dependencies needed for this app"}),"\n",(0,t.jsx)(n.li,{children:"picks up a port for internal reverse-proxying"}),"\n",(0,t.jsx)(n.li,{children:"initializes an empty SQL database"}),"\n",(0,t.jsx)(n.li,{children:"configures SSOwat permissions"}),"\n",(0,t.jsx)(n.li,{children:"..."}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsxs)(n.p,{children:["The actual app's ",(0,t.jsx)(n.code,{children:"install"})," script is ran and typically does:"]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"fetch and deploy the app sources"}),"\n",(0,t.jsx)(n.li,{children:"configure the app (typically DB credentials, internal reverse-proxy port...)"}),"\n",(0,t.jsx)(n.li,{children:"add the NGINX configuration"}),"\n",(0,t.jsx)(n.li,{children:"add the systemd configuration the app's daemon"}),"\n",(0,t.jsx)(n.li,{children:"starts the app daemon"}),"\n",(0,t.jsx)(n.li,{children:"various finialization tweaks"}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsx)(n.p,{children:"???"}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsx)(n.p,{children:"Application is ready to use!"}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"5-creating-your-very-first-yunohost-package",children:"5. Creating your very first YunoHost package"}),"\n",(0,t.jsxs)(n.p,{children:["Unless you really want to start from scratch or from ",(0,t.jsx)(n.a,{href:"https://github.com/YunoHost/example_ynh",children:(0,t.jsx)(n.code,{children:"example_ynh"})}),", one common practice is to identify an app similar to the one you're trying to package - typically because it relies on the same technologies - clone the corresponding code repository, and adapt the various files."]}),"\n",(0,t.jsx)(n.p,{children:"TODO/FIXME : here we should list a bunch of well-knowh apps for classic technologies"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"PHP apps:"}),"\n",(0,t.jsx)(n.li,{children:"NodeJS apps:"}),"\n",(0,t.jsx)(n.li,{children:"Python apps:"}),"\n",(0,t.jsx)(n.li,{children:"???"}),"\n"]})]})}function d(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(h,{...e})}):h(e)}},8453:(e,n,i)=>{i.d(n,{R:()=>a,x:()=>r});var s=i(6540);const t={},o=s.createContext(t);function a(e){const n=s.useContext(o);return s.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function r(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:a(e.components),s.createElement(o.Provider,{value:n},e.children)}}}]);