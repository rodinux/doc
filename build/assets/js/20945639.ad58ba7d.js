"use strict";(self.webpackChunkyunohost_docs=self.webpackChunkyunohost_docs||[]).push([[3503],{1335:(e,t,o)=>{o.d(t,{A:()=>r});const r=o.p+"assets/images/relay_smtp_option_webadmin_en-c0d1765ad827013b6b5273b72f3e4750.png"},2554:(e,t,o)=>{o.r(t),o.d(t,{assets:()=>d,contentTitle:()=>u,default:()=>y,frontMatter:()=>l,metadata:()=>r,toc:()=>c});const r=JSON.parse('{"id":"administer/tutorials/email_configure_relay","title":"Configure SMTP relay","description":"If your ISP blocks port 25, if you can\'t set a reverseDNS on your server, or if you have any other troubles using the built-in SMTP server on YunoHost, you may want to setup your YunoHost server to use an SMTP relay.","source":"@site/docs/03.administer/45.tutorials/35.email_configure_relay.mdx","sourceDirName":"03.administer/45.tutorials","slug":"/administer/tutorials/email_configure_relay","permalink":"/administer/tutorials/email_configure_relay","draft":false,"unlisted":false,"editUrl":"https://github.com/YunoHost/doc/tree/docusaurus/docs/03.administer/45.tutorials/35.email_configure_relay.mdx","tags":[],"version":"current","sidebarPosition":35,"frontMatter":{"title":"Configure SMTP relay"},"sidebar":"docsSidebar","previous":{"title":"Add external storage","permalink":"/administer/tutorials/external_storage"},"next":{"title":"Configure Tor Hidden Service","permalink":"/administer/tutorials/torhiddenservice"}}');var n=o(4848),a=o(8453),s=o(5537),i=o(9329);const l={title:"Configure SMTP relay"},u=void 0,d={},c=[{value:"What is an SMTP relay?",id:"what-is-an-smtp-relay",level:2},{value:"<FAIcon></FAIcon> Disadvantages of SMTP relays",id:"-disadvantages-of-smtp-relays",level:2},{value:"How to use an SMTP relay with YunoHost?",id:"how-to-use-an-smtp-relay-with-yunohost",level:2},{value:"Step 1: Register with an SMTP relay provider",id:"step-1-register-with-an-smtp-relay-provider",level:3},{value:"Step 2: Setup your DNS records correctly",id:"step-2-setup-your-dns-records-correctly",level:3},{value:"Step 3: Setup YunoHost correctly",id:"step-3-setup-yunohost-correctly",level:3},{value:"Relay all emails, even those from domains managed by YunoHost",id:"relay-all-emails-even-those-from-domains-managed-by-yunohost",level:4},{value:"Step 4: Check your setup",id:"step-4-check-your-setup",level:3}];function h(e){const t={a:"a",admonition:"admonition",code:"code",h2:"h2",h3:"h3",h4:"h4",img:"img",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,a.R)(),...e.components},{FAIcon:r}=t;return r||function(e,t){throw new Error("Expected "+(t?"component":"object")+" `"+e+"` to be defined: you likely forgot to import, pass, or provide it.")}("FAIcon",!0),(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(t.p,{children:"If your ISP blocks port 25, if you can't set a reverseDNS on your server, or if you have any other troubles using the built-in SMTP server on YunoHost, you may want to setup your YunoHost server to use an SMTP relay."}),"\n",(0,n.jsx)(t.h2,{id:"what-is-an-smtp-relay",children:"What is an SMTP relay?"}),"\n",(0,n.jsx)(t.p,{children:"An SMTP relay is basically a third party hosted SMTP server that will send emails on behalf of your own SMTP server (Postfix service on YunoHost).\nOnce setup correctly on YunoHost, its operation is transparent, both for you and for your correspondents: they will see emails as coming from your YunoHost main URL, but all the sending will be delegated to the SMTP relay you have chosen and configured."}),"\n",(0,n.jsxs)(t.h2,{id:"-disadvantages-of-smtp-relays",children:[(0,n.jsx)(r,{icon:"fa-exclamation-triangle"})," Disadvantages of SMTP relays"]}),"\n",(0,n.jsx)(t.p,{children:"It's important to note that using an SMTP relay has to be seen as a (big) compromise in the world of self-hosting. Indeed, when using an SMTP relay, not only a third party sends emails on your behalf, but it has full access to the content of all the emails you'll send and can also possibly modify them (For example, by default, MailJet rewrites the html hyperlinks contained in your emails, in order to track the activity of your correspondents). Be also aware that an SMTP relay is setup for your whole YunoHost server: you can't choose which emails or which users go through it because all future emails will."}),"\n",(0,n.jsxs)(t.p,{children:["Beyond the privacy considerations above, an SMTP relay can impose technical limitations that one would not have if port 25 was open. For example, with most relays, if a user of your YunoHost server declares ",(0,n.jsx)(t.strong,{children:'an external "forwarding address"'})," in order to automatically forward messages received on your YunoHost server to another mailbox, ",(0,n.jsx)(t.strong,{children:"such forwarding will not work"}),' for emails originating from outside your server, without any warning. Indeed, relays generally require that the messages they forward have a sender address from your domain (to fight spam and preserve the reputation of their services), which is not the case for an "automatic forward" where the original sender of the mail is kept; the message is then blocked by the relay (which, normally, warns your YunoHost admin, but only afterwards)']}),"\n",(0,n.jsx)(t.h2,{id:"how-to-use-an-smtp-relay-with-yunohost",children:"How to use an SMTP relay with YunoHost?"}),"\n",(0,n.jsx)(t.p,{children:"YunoHost has a built-in SMTP relay configuration, available from version 4.1. That configuration is not yet available from the admin web interface, though. You will have to use the command line interface."}),"\n",(0,n.jsx)(t.h3,{id:"step-1-register-with-an-smtp-relay-provider",children:"Step 1: Register with an SMTP relay provider"}),"\n",(0,n.jsx)(t.p,{children:"Many providers exist. Some have free plans with or without limitations, it's up to you. As written above, you have to be careful with your choice as you will basically handover all your emails to that third party. Whether you can trust it or not, that's your call!"}),"\n",(0,n.jsx)(t.h3,{id:"step-2-setup-your-dns-records-correctly",children:"Step 2: Setup your DNS records correctly"}),"\n",(0,n.jsx)(t.p,{children:"Once registered, the SMTP relay provider will usually ask you to modify your DNS.\nStandard procedure is to add a DKIM key and a SPF key to your DNS records.\nThe way to modify these records and the value of the keys you'll have to add depend both on your domain name provider and SMTP relay provider."}),"\n",(0,n.jsx)(t.p,{children:'Usually, the SMTP relay provider will provide you with a guide on how to modify these records, together with an automatic check tool that will tell you when your DNS have been setup correctly. That step is mandatory to prove "the world" that you, owner of your domain name, did explicitly authorize your SMTP relay provider to send emails on your behalf.'}),"\n",(0,n.jsx)(t.p,{children:"Please note that modifying your DNS records could sometimes take over 24h to take effect, so be patient!"}),"\n",(0,n.jsx)(t.admonition,{type:"warning",children:(0,n.jsxs)(t.p,{children:[(0,n.jsx)(r,{icon:"fa-exclamation-triangle"})," From now on, a non trusty SMTP relay provider could send emails from your main domain without telling you."]})}),"\n",(0,n.jsx)(t.h3,{id:"step-3-setup-yunohost-correctly",children:"Step 3: Setup YunoHost correctly"}),"\n",(0,n.jsx)(t.p,{children:"It can be configured either from the webadmin or the command line."}),"\n",(0,n.jsxs)(s.A,{groupId:"admin-commands",children:[(0,n.jsxs)(i.A,{value:"web",label:"From the web interface",children:[(0,n.jsxs)(t.p,{children:["Go to your web admin, in ",(0,n.jsx)(t.code,{children:"Tools"})," > ",(0,n.jsx)(t.code,{children:"Yunohost Settings"})," and ",(0,n.jsx)(t.code,{children:"Email"}),".\nNow set all options requests :"]}),(0,n.jsxs)(t.ul,{children:["\n",(0,n.jsxs)(t.li,{children:[(0,n.jsx)(t.strong,{children:"SMTP relay host"})," : SMTP server url."]}),"\n",(0,n.jsxs)(t.li,{children:[(0,n.jsx)(t.strong,{children:"SMTP relay port"})," : Port use with the distant server."]}),"\n",(0,n.jsxs)(t.li,{children:[(0,n.jsx)(t.strong,{children:"SMTP relay user"})," : Login or identification mail server."]}),"\n",(0,n.jsxs)(t.li,{children:[(0,n.jsx)(t.strong,{children:"SMTP relay password"})," : Your SMTP relay password."]}),"\n"]}),(0,n.jsx)(t.admonition,{type:"warning",children:(0,n.jsxs)(t.p,{children:[(0,n.jsx)(r,{icon:"fa-exclamation-triangle"})," Password with ",(0,n.jsx)(t.code,{children:"#"})," char won't works properly due to postfix limitation (it's possible other chars are forbidden, don't hesitate to report it to update this doc)."]})}),(0,n.jsx)(t.p,{children:(0,n.jsx)(t.img,{alt:"Option-Relais-Smtp",src:o(1335).A+"",width:"1722",height:"1246"})})]}),(0,n.jsxs)(i.A,{value:"cli",label:"From the command line",children:[(0,n.jsx)(t.p,{children:"In order to setup your YunoHost to use your SMTP relay, you will have to configure four things:"}),(0,n.jsxs)(t.ol,{children:["\n",(0,n.jsxs)(t.li,{children:["Your SMTP relay URL (for this tutorial we will use ",(0,n.jsx)(t.code,{children:"smtprelay.tld"}),")"]}),"\n",(0,n.jsx)(t.li,{children:"The port on which you access the relay (for this tutorial we will use port 2525 below)"}),"\n",(0,n.jsxs)(t.li,{children:["Your SMTP relay username (for this tutorial we will use ",(0,n.jsx)(t.code,{children:"username"}),")"]}),"\n",(0,n.jsxs)(t.li,{children:["Your SMTP relay password (for this tutorial we will use ",(0,n.jsx)(t.code,{children:"password"}),")"]}),"\n"]}),(0,n.jsx)(t.admonition,{type:"warning",children:(0,n.jsxs)(t.p,{children:[(0,n.jsx)(r,{icon:"fa-exclamation-triangle"})," Password with ",(0,n.jsx)(t.code,{children:"#"})," char won't works properly due to postfix limitation (it's possible other chars are forbidden, don't hesitate to report it to update this doc)."]})}),(0,n.jsx)(t.p,{children:"Your SMTP relay will obviously provide you with these four things, that should be available in your control panel or whatsoever."}),(0,n.jsx)(t.p,{children:"You can log into your YunoHost server using SSH:"}),(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-bash",children:"ssh admin@yourdomain.tld\n"})}),(0,n.jsx)(t.p,{children:"Then you can update the three values as below:"}),(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-bash",children:"sudo yunohost settings set email.smtp.smtp_relay_enabled -v yes\nsudo yunohost settings set smtp.relay.host -v smtprelay.tld\nsudo yunohost settings set smtp.relay.port -v 2525\nsudo yunohost settings set smtp.relay.user -v username\nsudo yunohost settings set smtp.relay.password -v password\n"})}),(0,n.jsx)(t.p,{children:"It may be a good idea to double confirm your settings by doing:"}),(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-bash",children:"sudo yunohost settings list\n"})})]})]}),"\n",(0,n.jsx)(t.p,{children:"Your SMTP relay is now configured!"}),"\n",(0,n.jsx)(t.admonition,{type:"warning",children:(0,n.jsxs)(t.p,{children:[(0,n.jsx)(r,{icon:"fa-exclamation-triangle"})," From now on, a non trusty SMTP relay provider could read or use the data of all the emails you send without telling you (but still won't be able to read nor to use the data from emails you receive)."]})}),"\n",(0,n.jsx)(t.h4,{id:"relay-all-emails-even-those-from-domains-managed-by-yunohost",children:"Relay all emails, even those from domains managed by YunoHost"}),"\n",(0,n.jsxs)(t.p,{children:["If you have plenty of trust in your SMTP relay, have a second IMAP server that you wish or are forced to use instead of the YunoHost one, you can choose to relay all emails even those from domain names managed by YunoHost by commenting the following two lines in ",(0,n.jsx)(t.code,{children:"/etc/postfix/main.cf"})," :"]}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-text",children:"#virtual_mailbox_domains = ldap:/etc/postfix/ldap-domains.cf\n#virtual_alias_maps = ldap:/etc/postfix/ldap-aliases.cf,ldap:/etc/postfix/ldap-groups.cf\n"})}),"\n",(0,n.jsx)(t.h3,{id:"step-4-check-your-setup",children:"Step 4: Check your setup"}),"\n",(0,n.jsxs)(t.p,{children:["You can check your setup by sending emails and try if everything works.\nSome of the SMTP relay will give you insights about the emails you send so that can also be a good way to check that everythings works as needed.\nOf course, you can always have a try with ",(0,n.jsx)(t.a,{href:"https://www.mail-tester.com/",children:"mail-tester.com"})," to check for any problem or discrepancy."]})]})}function y(e={}){const{wrapper:t}={...(0,a.R)(),...e.components};return t?(0,n.jsx)(t,{...e,children:(0,n.jsx)(h,{...e})}):h(e)}},5537:(e,t,o)=>{o.d(t,{A:()=>j});var r=o(6540),n=o(4164),a=o(5627),s=o(6347),i=o(372),l=o(604),u=o(1861),d=o(8749);function c(e){return r.Children.toArray(e).filter((e=>"\n"!==e)).map((e=>{if(!e||(0,r.isValidElement)(e)&&function(e){const{props:t}=e;return!!t&&"object"==typeof t&&"value"in t}(e))return e;throw new Error(`Docusaurus error: Bad <Tabs> child <${"string"==typeof e.type?e.type:e.type.name}>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.`)}))?.filter(Boolean)??[]}function h(e){const{values:t,children:o}=e;return(0,r.useMemo)((()=>{const e=t??function(e){return c(e).map((e=>{let{props:{value:t,label:o,attributes:r,default:n}}=e;return{value:t,label:o,attributes:r,default:n}}))}(o);return function(e){const t=(0,u.XI)(e,((e,t)=>e.value===t.value));if(t.length>0)throw new Error(`Docusaurus error: Duplicate values "${t.map((e=>e.value)).join(", ")}" found in <Tabs>. Every value needs to be unique.`)}(e),e}),[t,o])}function y(e){let{value:t,tabValues:o}=e;return o.some((e=>e.value===t))}function p(e){let{queryString:t=!1,groupId:o}=e;const n=(0,s.W6)(),a=function(e){let{queryString:t=!1,groupId:o}=e;if("string"==typeof t)return t;if(!1===t)return null;if(!0===t&&!o)throw new Error('Docusaurus error: The <Tabs> component groupId prop is required if queryString=true, because this value is used as the search param name. You can also provide an explicit value such as queryString="my-search-param".');return o??null}({queryString:t,groupId:o});return[(0,l.aZ)(a),(0,r.useCallback)((e=>{if(!a)return;const t=new URLSearchParams(n.location.search);t.set(a,e),n.replace({...n.location,search:t.toString()})}),[a,n])]}function m(e){const{defaultValue:t,queryString:o=!1,groupId:n}=e,a=h(e),[s,l]=(0,r.useState)((()=>function(e){let{defaultValue:t,tabValues:o}=e;if(0===o.length)throw new Error("Docusaurus error: the <Tabs> component requires at least one <TabItem> children component");if(t){if(!y({value:t,tabValues:o}))throw new Error(`Docusaurus error: The <Tabs> has a defaultValue "${t}" but none of its children has the corresponding value. Available values are: ${o.map((e=>e.value)).join(", ")}. If you intend to show no default tab, use defaultValue={null} instead.`);return t}const r=o.find((e=>e.default))??o[0];if(!r)throw new Error("Unexpected error: 0 tabValues");return r.value}({defaultValue:t,tabValues:a}))),[u,c]=p({queryString:o,groupId:n}),[m,f]=function(e){let{groupId:t}=e;const o=function(e){return e?`docusaurus.tab.${e}`:null}(t),[n,a]=(0,d.Dv)(o);return[n,(0,r.useCallback)((e=>{o&&a.set(e)}),[o,a])]}({groupId:n}),v=(()=>{const e=u??m;return y({value:e,tabValues:a})?e:null})();(0,i.A)((()=>{v&&l(v)}),[v]);return{selectedValue:s,selectValue:(0,r.useCallback)((e=>{if(!y({value:e,tabValues:a}))throw new Error(`Can't select invalid tab value=${e}`);l(e),c(e),f(e)}),[c,f,a]),tabValues:a}}var f=o(9136);const v={tabList:"tabList__CuJ",tabItem:"tabItem_LNqP"};var g=o(4848);function w(e){let{className:t,block:o,selectedValue:r,selectValue:s,tabValues:i}=e;const l=[],{blockElementScrollPositionUntilNextRender:u}=(0,a.a_)(),d=e=>{const t=e.currentTarget,o=l.indexOf(t),n=i[o].value;n!==r&&(u(t),s(n))},c=e=>{let t=null;switch(e.key){case"Enter":d(e);break;case"ArrowRight":{const o=l.indexOf(e.currentTarget)+1;t=l[o]??l[0];break}case"ArrowLeft":{const o=l.indexOf(e.currentTarget)-1;t=l[o]??l[l.length-1];break}}t?.focus()};return(0,g.jsx)("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,n.A)("tabs",{"tabs--block":o},t),children:i.map((e=>{let{value:t,label:o,attributes:a}=e;return(0,g.jsx)("li",{role:"tab",tabIndex:r===t?0:-1,"aria-selected":r===t,ref:e=>{l.push(e)},onKeyDown:c,onClick:d,...a,className:(0,n.A)("tabs__item",v.tabItem,a?.className,{"tabs__item--active":r===t}),children:o??t},t)}))})}function b(e){let{lazy:t,children:o,selectedValue:a}=e;const s=(Array.isArray(o)?o:[o]).filter(Boolean);if(t){const e=s.find((e=>e.props.value===a));return e?(0,r.cloneElement)(e,{className:(0,n.A)("margin-top--md",e.props.className)}):null}return(0,g.jsx)("div",{className:"margin-top--md",children:s.map(((e,t)=>(0,r.cloneElement)(e,{key:t,hidden:e.props.value!==a})))})}function x(e){const t=m(e);return(0,g.jsxs)("div",{className:(0,n.A)("tabs-container",v.tabList),children:[(0,g.jsx)(w,{...t,...e}),(0,g.jsx)(b,{...t,...e})]})}function j(e){const t=(0,f.A)();return(0,g.jsx)(x,{...e,children:c(e.children)},String(t))}},8453:(e,t,o)=>{o.d(t,{R:()=>s,x:()=>i});var r=o(6540);const n={},a=r.createContext(n);function s(e){const t=r.useContext(a);return r.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function i(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(n):e.components||n:s(e.components),r.createElement(a.Provider,{value:t},e.children)}},9329:(e,t,o)=>{o.d(t,{A:()=>s});o(6540);var r=o(4164);const n={tabItem:"tabItem_Ymn6"};var a=o(4848);function s(e){let{children:t,hidden:o,className:s}=e;return(0,a.jsx)("div",{role:"tabpanel",className:(0,r.A)(n.tabItem,s),hidden:o,children:t})}}}]);