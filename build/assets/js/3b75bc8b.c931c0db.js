"use strict";(self.webpackChunkyunohost_docs=self.webpackChunkyunohost_docs||[]).push([[3311],{5238:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>a,contentTitle:()=>h,default:()=>l,frontMatter:()=>r,metadata:()=>o,toc:()=>d});const o=JSON.parse('{"id":"contribute/dev/index","title":"Contributing to the core","description":"You wish to add a new feature in the YunoHost core, but don\'t know how to","source":"@site/docs/06.contribute/15.dev/index.mdx","sourceDirName":"06.contribute/15.dev","slug":"/contribute/dev/","permalink":"/contribute/dev/","draft":false,"unlisted":false,"editUrl":"https://github.com/YunoHost/doc/tree/docusaurus/docs/06.contribute/15.dev/index.mdx","tags":[],"version":"current","frontMatter":{"title":"Contributing to the core"},"sidebar":"docsSidebar","previous":{"title":"Apps catalog policy","permalink":"/contribute/packaging_apps/policy"},"next":{"title":"Technical details for config panel structure and form option types","permalink":"/contribute/dev/forms"}}');var s=t(4848),i=t(8453);const r={title:"Contributing to the core"},h=void 0,a={},d=[{value:"Setting up a development environment",id:"setting-up-a-development-environment",level:3},{value:"Overview of the 4 main pieces of YunoHost",id:"overview-of-the-4-main-pieces-of-yunohost",level:3},{value:"Moulinette",id:"moulinette",level:4},{value:"YunoHost",id:"yunohost",level:4},{value:"SSOwat",id:"ssowat",level:4},{value:"YunoHost-admin",id:"yunohost-admin",level:4},{value:"Working on the YunoHost Python/CLI core",id:"working-on-the-yunohost-pythoncli-core",level:3},{value:"Helpers / coding style",id:"helpers--coding-style",level:4},{value:"Working on the YunoHost web administration interface",id:"working-on-the-yunohost-web-administration-interface",level:3},{value:"Don&#39;t forget",id:"dont-forget",level:4},{value:"Your feature is ready and you want it to be integrated in YunoHost",id:"your-feature-is-ready-and-you-want-it-to-be-integrated-in-yunohost",level:3}];function c(e){const n={a:"a",code:"code",em:"em",h3:"h3",h4:"h4",li:"li",p:"p",strong:"strong",ul:"ul",...(0,i.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.p,{children:"You wish to add a new feature in the YunoHost core, but don't know how to\nproceed? This guide takes you through the various steps of the development and\ncontribution process."}),"\n",(0,s.jsxs)(n.p,{children:["If you're looking for stuff to implement or fix, the bug-tracker is\n",(0,s.jsx)(n.a,{href:"https://github.com/YunoHost/issues/issues",children:"here"}),"!"]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsxs)(n.strong,{children:["Come say hi to us in the ",(0,s.jsx)(n.a,{href:"/chat_rooms",children:"dev chat room"})]}),"!"]}),"\n",(0,s.jsx)(n.h3,{id:"setting-up-a-development-environment",children:"Setting up a development environment"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:[(0,s.jsxs)(n.strong,{children:["Use ",(0,s.jsx)(n.a,{href:"https://github.com/YunoHost/ynh-dev",children:"ynh-dev"})]})," (see the README) to\nsetup a development environment - locally in a virtual machine, or on a VPS.\nThis will setup a working YunoHost instance, using directly the Git repositories\n(with symlinks). That way, you will be able to edit files, test your changes in real\ntime, commit stuff and push/pull directly from your development environment."]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Implement and test your feature"}),". Depending on what you want to develop, you\nwill want to:"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Python/CLI core"}),": work in ",(0,s.jsx)(n.code,{children:"/ynh-dev/yunohost/"})]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Web administration interface"}),": work in ",(0,s.jsx)(n.code,{children:"/ynh-dev/yunohost-admin/"})]}),"\n",(0,s.jsx)(n.li,{children:"You can also work on the other projects on which YunoHost is built\n(SSOwat, Moulinette) in similar ways"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"overview-of-the-4-main-pieces-of-yunohost",children:"Overview of the 4 main pieces of YunoHost"}),"\n",(0,s.jsx)(n.h4,{id:"moulinette",children:"Moulinette"}),"\n",(0,s.jsxs)(n.p,{children:['It is a small "homemade" framework. ',(0,s.jsx)(n.a,{href:"https://moulinette.readthedocs.io/en/latest/actionsmap.html",children:"Its major role"}),"\nis to allow us to build both a web API and a command-line API from the same\nPython code thanks to a YAML schema which we call\n",(0,s.jsx)(n.a,{href:"https://github.com/YunoHost/yunohost/blob/dev/share/actionsmap.yml",children:"the actionmap"}),"."]}),"\n",(0,s.jsx)(n.p,{children:"It handles other mechanisms like authentication, internationalization and\nsmall technical utilitary functions (e.g. reading/writing JSON)."}),"\n",(0,s.jsxs)(n.p,{children:["Moulinette has its own documentation available ",(0,s.jsx)(n.a,{href:"https://moulinette.readthedocs.io/en/latest/",children:"here"}),"."]}),"\n",(0,s.jsx)(n.h4,{id:"yunohost",children:"YunoHost"}),"\n",(0,s.jsx)(n.p,{children:"This piece is the very core of YunoHost. It contains:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.a,{href:"https://github.com/YunoHost/yunohost/tree/dev/src",children:"the Python code"})," that manages users, domains, apps, services and other things"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.a,{href:"https://github.com/YunoHost/yunohost/tree/dev/helpers",children:"bash helpers"})," mainly used by application packagers to package applications"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.a,{href:"https://github.com/YunoHost/yunohost/tree/dev/hooks",children:"hooks"})," and ",(0,s.jsx)(n.a,{href:"https://github.com/YunoHost/yunohost/tree/dev/conf",children:"templates"})," that are used to configure the various pieces of the ecosystem such as NGINX, Postfix..."]}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"https://github.com/YunoHost/yunohost/tree/dev/locales",children:"internationalized strings"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"https://github.com/YunoHost/yunohost/tree/dev/tests",children:"tests"})}),"\n"]}),"\n",(0,s.jsx)(n.h4,{id:"ssowat",children:"SSOwat"}),"\n",(0,s.jsx)(n.p,{children:"This is the single sign-on system of YunoHost. It both contains:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.a,{href:"https://github.com/YunoHost/ssowat",children:"Lua scripts"}),' that are directly interfaced with NGINX and handle all the "technical" aspects of authentication and route accesses']}),"\n",(0,s.jsxs)(n.li,{children:["the web ",(0,s.jsx)(n.a,{href:"https://github.com/YunoHost/SSOwat/tree/dev/portal",children:"user portal"})," which is the interface used by YunoHost's end users to log in and browse installed apps"]}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:["SSOwat is configured through ",(0,s.jsx)(n.code,{children:"/etc/ssowat/conf.json"})," which is generated by YunoHost."]}),"\n",(0,s.jsx)(n.h4,{id:"yunohost-admin",children:"YunoHost-admin"}),"\n",(0,s.jsxs)(n.p,{children:["It is an ",(0,s.jsx)(n.em,{children:"optional"})," dependency of YunoHost and corresponds to an interface for the web API created by YunoHost and Moulinette (c.f. the ",(0,s.jsx)(n.code,{children:"yunohost-api"})," service)."]}),"\n",(0,s.jsx)(n.p,{children:"It essentially contains:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"https://github.com/YunoHost/yunohost-admin/tree/dev/app/src/views",children:"view templates"})}),"\n",(0,s.jsxs)(n.li,{children:["corresponding ",(0,s.jsx)(n.a,{href:"https://github.com/YunoHost/yunohost-admin/tree/dev/src/js/yunohost/controllers",children:"JavaScript controllers"})," that interact with the YunoHost API"]}),"\n",(0,s.jsxs)(n.li,{children:["and ",(0,s.jsx)(n.a,{href:"https://github.com/YunoHost/yunohost-admin/tree/dev/app/src/i18n/locales",children:"internationalized strings"})]}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"working-on-the-yunohost-pythoncli-core",children:"Working on the YunoHost Python/CLI core"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:["Work in ",(0,s.jsx)(n.code,{children:"/ynh-dev/yunohost/"}),"."]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:["Run ",(0,s.jsx)(n.code,{children:"cd /ynh_dev/ && ./ynh-dev use-git yunohost"}),"."]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:["The actionsmap file (",(0,s.jsx)(n.code,{children:"data/actionsmap/yunohost.yml"}),") defines the various\ncategories, actions and arguments of the YunoHost CLI. Define how you want\nusers to use your feature, and add/edit the corresponding categories, actions\nand arguments. For example in ",(0,s.jsx)(n.code,{children:"yunohost domain add some.domain.tld"}),", the\ncategory is ",(0,s.jsx)(n.code,{children:"domain"}),", the action is ",(0,s.jsx)(n.code,{children:"add"}),", and ",(0,s.jsx)(n.code,{children:"some.domain.tld"})," is an\nargument."]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:["Moulinette will automatically map commands in the actionsmap to Python\nfunctions (and their arguments) located in ",(0,s.jsx)(n.code,{children:"src/yunohost/"}),". For example, typing\n",(0,s.jsx)(n.code,{children:"yunohost domain add some.domain.tld"})," will call the function\n",(0,s.jsx)(n.code,{children:"domain_add(domainName)"})," in ",(0,s.jsx)(n.code,{children:"domain.py"}),", with the argument ",(0,s.jsx)(n.code,{children:"domainName"})," equal\nto ",(0,s.jsx)(n.code,{children:'"some.domain.tld"'}),"."]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.h4,{id:"helpers--coding-style",children:"Helpers / coding style"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:["To handle exceptions, you should raise some ",(0,s.jsx)(n.code,{children:"YunohostError()"})]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:["To help with internationalizing the messages, use ",(0,s.jsx)(n.code,{children:"m18n.n('some-message-id')"}),"\nand put your string in ",(0,s.jsx)(n.code,{children:"locales/en.json"}),". You can also put arguments and use\nthem in the string with ",(0,s.jsx)(n.code,{children:"{{some-argument:s}}"}),". Don't edit other locales files,\nthis will be done using ",(0,s.jsx)(n.a,{href:"https://translate.yunohost.org/",children:"weblate"})," !"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:["YunoHost tries to follow the ",(0,s.jsx)(n.a,{href:"http://pep8.org/",children:"pep8"})," coding style. Tools\nexist to automatically check conformity."]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:['Name of "private" functions should start with a ',(0,s.jsx)(n.code,{children:"_"})]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"working-on-the-yunohost-web-administration-interface",children:"Working on the YunoHost web administration interface"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:["Work in ",(0,s.jsx)(n.code,{children:"/ynh-dev/yunohost-admin/src/"}),"."]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:["Run ",(0,s.jsx)(n.code,{children:"cd /ynh-dev && ./ynh-dev use-git yunohost-admin"}),". It launches gulp, such as each\ntime you modify sources, it recompiles the code and you can use it by\nrefreshing (Ctrl+F5) your web administration. To stop the command, just do Ctrl+C."]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:["The web interface uses the API to interact with YunoHost. The API\ncommands/requests are also defined via the actionsmap. For instance, accessing\nthe page ",(0,s.jsx)(n.code,{children:"https://domain.tld/yunohost/api/users"})," corresponds to a ",(0,s.jsx)(n.code,{children:"GET /users"})," requests on the YunoHost API. It is mapped to the function\n",(0,s.jsx)(n.code,{children:"user_list()"}),". Accessing the URL should display the JSON returned by this\nfunction. 'GET' requests are typically meant to ask information to the server.\n'POST' requests are meant to ask the server to edit/change some information,\nor to execute some actions."]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.code,{children:"js/yunohost/controllers"})," contains the JavaScript parts,\nand define which requests to make to the API when loading a specific page of\nthe interface, and how to process the data to generate the page, using\ntemplates."]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.code,{children:"views"})," contains the various templates for the pages of the interface. In the\ntemplate, data coming from the JavaScript part can be used with the syntax\n",(0,s.jsx)(n.code,{children:"{{some-variable}}"}),", which will be replaced when building/accessing the page.\nIt is also possible to have conditions using the\n",(0,s.jsx)(n.a,{href:"http://handlebarsjs.com",children:"handlebars.js"})," syntax: ",(0,s.jsx)(n.code,{children:"{{#if some-variable}}<p>Some conditional HTML code here !</p>{{/if}}"})]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:["For internationalized strings, use ",(0,s.jsx)(n.code,{children:"y18n.t('some-string-code')"})," in the\nJavaScript, or ",(0,s.jsx)(n.code,{children:"{{t 'some-string-code'}}"})," in the HTML template, and put your\nstring in ",(0,s.jsx)(n.code,{children:"locales/en.json"}),". Don't edit other locales files,\nthis will be done using ",(0,s.jsx)(n.a,{href:"https://translate.yunohost.org/",children:"Weblate"}),"!"]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.h4,{id:"dont-forget",children:"Don't forget"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:["Each time you edit the actionsmap or the Python code, you should restart the YunoHost api:\n",(0,s.jsx)(n.code,{children:"systemctl restart yunohost-api"}),"\n(You'll need to retype your admin and password in the web interface)"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:["You might need to force-clear the cache of your browser sometimes to refresh\nthe JavaScript and/or HTML (so each time you edit something in ",(0,s.jsx)(n.code,{children:"js"})," or ",(0,s.jsx)(n.code,{children:"views"}),")."]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"your-feature-is-ready-and-you-want-it-to-be-integrated-in-yunohost",children:"Your feature is ready and you want it to be integrated in YunoHost"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"Fork the relevant repo on GitHub, and commit stuff to a new branch. We recommend\nto name the branch with the following convention:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["For an enhancement or new feature: ",(0,s.jsx)(n.code,{children:"enh-ISSUENUMBER-name-of-feature"})]}),"\n",(0,s.jsxs)(n.li,{children:["For a bugfix ",(0,s.jsx)(n.code,{children:"fix-ISSUENUMBER-description-of-fix"})]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"ISSUENUMBER"})," is optional and is the id of a corresponding ticket on the bug tracker."]}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:["Once you're ready, open a Pull Request (PR) on GitHub. Please include ",(0,s.jsx)(n.code,{children:"[fix]"})," or\n",(0,s.jsx)(n.code,{children:"[enh]"})," at the beginning of the title of your PR."]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:["After reviewing, testing and validation by other contributors, your branch\nshould be merged in ",(0,s.jsx)(n.code,{children:"unstable"}),"!"]}),"\n"]}),"\n"]})]})}function l(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(c,{...e})}):c(e)}},8453:(e,n,t)=>{t.d(n,{R:()=>r,x:()=>h});var o=t(6540);const s={},i=o.createContext(s);function r(e){const n=o.useContext(i);return o.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function h(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:r(e.components),o.createElement(i.Provider,{value:n},e.children)}}}]);